{ lib, pkgs, ... }:
let
  inherit (lib) mapAttrs' nameValuePair generators;
  toJSON = generators.toJSON {};
in
rec {
  mkSettingsJSON = root: settings:
    settings |> mapAttrs' (path: contents: 
      nameValuePair (root + path) { text = toJSON contents; });
  
  mkJson = name: raw:
    let text = toJSON raw;
    in {
      inherit raw text;
      file = pkgs.writeTextFile { inherit name text; };
    };
  
  assign = output: WSs:
    map (workspace: { inherit workspace output; }) WSs;
}